libspectrum draft API
=====================

$Id$

In general, user code should never use the libspectrum_* objects
directly, but only pointers to them so binary compatibility can be
maintained if (when) the data structures change.

Naming conventions:

*_alloc: give us a new object
*_free:  we're done with this object
*_read:  restore object from serialised form
*_write: serialise object

Calling conventions:

* In general, all output parameters (those which may be changed by
  the function) should be before all input parameters

General functions
-----------------

const char* libspectrum_error_message( libspectrum_error error )
/* Give a message describing `error'
   Should this be thrown away completely and replaced with the new
   error stuff? */

const char* libspectrum_machine_name( libspectrum_machine type )
/* A textual name for `type' */

int libspectrum_machine_capabilities( libspectrum_machine type )
/* What special memory etc capabilities does `type' have */

Snapshot functions
------------------

libspectrum_error libspectrum_snap_alloc( libspectrum_snap **snap )
libspectrum_error libspectrum_snap_free( libspectrum_snap *snap )

libspectrum_error libspectrum_sna_read( libspectrum_snap *snap,
		                        const libspectrum_byte *buffer,
				        size_t buffer_length )
libspectrum_error libspectrum_z80_read( libspectrum_snap *snap,
		                        const libspectrum_byte *buffer,
					size_t buffer_length )
libspectrum_error libspectrum_z80_write( libspectrum_byte **buffer,
					 size_t *length,
					 libspectrum_snap *snap )

Tape functions
--------------

libspectrum_error libspectrum_tape_alloc( libspectrum_tape **tape )
libspectrum_error libspectrum_tape_free( libspectrum_tape *tape )

libspectrum_error libspectrum_tape_clear( libspectrum_tape *tape )
/* Remove all blocks from the current tape */

int libspectrum_tape_present( libspectrum_tape *tape )
/* Does this tape structure actually contain a tape? */

libspectrum_error libspectrum_tape_init_block( libspectrum_tape_block *block )
/* Initialise a block so it can be used for playback */

libspectrum_error libspectrum_tape_get_next_edge( libspectrum_dword *tstates,
						  int *flags,
						  libspectrum_tape *tape )
/* How long will it be until the next edge from this tape? */

libspectrum_error libspectrum_tape_position( int *n, libspectrum_tape *tape )
/* Get the position on the tape of the current block */

libspectrum_error libspectrum_tape_nth_block( libspectrum_tape *tape, int n )
/* Select the nth block on the tape */

libspectrum_error
libspectrum_tape_block_description( char *buffer, size_t length,
				    libspectrum_tape_block *block )
/* Give a textual representation of the type of `block' */

libspectrum_error
libspectrum_tap_read( libspectrum_tape *tape, const libspectrum_byte *buffer,
	              const size_t length )
libspectrum_error
libspectrum_tap_write( libspectrum_byte **buffer, size_t *length,
		       libspectrum_tape *tape )

libspectrum_error
libspectrum_tzx_read( libspectrum_tape *tape, const libspectrum_byte *buffer,
		      const size_t length )
libspectrum_error
libspectrum_tzx_write( libspectrum_byte **buffer, size_t *length,
		       libspectrum_tape *tape )

RZX functions
-------------

libspectrum_error libspectrum_rzx_alloc( libspectrum_rzx **rzx )
libspectrum_error libspectrum_rzx_free( libspectrum_rzx *rzx )

libspectrum_error libspectrum_rzx_store_frame( libspectrum_rzx *rzx,
					       size_t instructions, 
					       size_t count,
					       libspectrum_byte *in_bytes )
/* Add a frame to the current RZX recording */

libspectrum_error libspectrum_rzx_start_playback( libspectrum_rzx *rzx )
/* Prepare to start playback from an RZX file */

libspectrum_error libspectrum_rzx_playback_frame( libspectrum_rzx *rzx,
                                                  int *finished )
/* Move onto the next frame of RZX playback */

libspectrum_error libspectrum_rzx_playback( libspectrum_rzx *rzx,
                                            libspectrum_byte *byte )
/* Get the next byte of the current RZX frame */

size_t libspectrum_rzx_tstates( libspectrum_rzx *rzx );
size_t libspectrum_rzx_set_tstates( libspectrum_rzx *rzx, size_t tstates )
/* Get and set the tstate counter */

size_t libspectrum_rzx_instructions( libspectrum_rzx *rzx )
/* Get the current frame's instruction count */

libspectrum_error
libspectrum_rzx_read( libspectrum_rzx *rzx, libspectrum_snap **snap,
		      const libspectrum_byte *buffer, const size_t length )
libspectrum_error
libspectrum_rzx_write( libspectrum_byte **buffer, size_t *length,
		       libspectrum_rzx *rzx,
		       libspectrum_byte *snap, size_t snap_length,
		       const char *program, libspectrum_word major,
		       libspectrum_word minor, int compress )
